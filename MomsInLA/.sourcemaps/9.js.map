{"version":3,"sources":["../../src/pages/activitylist/activitylist.module.ts","../../src/pages/activitylist/activitylist.ts"],"names":[],"mappings":"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","file":"9.js","sourcesContent":["import { NgModule} from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ActivitylistPage } from './activitylist';\n\n@NgModule({\n  declarations: [\n    ActivitylistPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ActivitylistPage),\n  ],\n  entryComponents: [\n    ActivitylistPage,\n  ]\n})\nexport class ActivitylistPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/activitylist/activitylist.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, PopoverController, Events} from 'ionic-angular';\nimport { FirebaseServiceProvider } from '../../providers/firebase-service/firebase-service';\nimport { map, take } from 'rxjs/operators';\nimport { NativeGeocoder, NativeGeocoderOptions, NativeGeocoderReverseResult } from '@ionic-native/native-geocoder';\nimport { ActivityFilterComponent } from '../../components/activity-filter/activity-filter';\nimport { Geolocation } from '@ionic-native/geolocation';\nimport { TimeFormatProvider } from '../../providers/time-format/time-format';\n\ndeclare var google;\n@IonicPage()\n\n@Component({\n  selector: 'page-activitylist',\n  templateUrl: 'activitylist.html',\n})\nexport class ActivitylistPage {\n\n  disp$: any = [];\n  cityLocation: string;\n  longitude: number;\n  latitude: number;\n  isLocated: boolean = false;\n  isLoaded: boolean = false;\n  sub: any;\n\n  constructor(\n    public navCtrl: NavController, \n    public navParams: NavParams, \n    public fsp: FirebaseServiceProvider,\n    private geocoder: NativeGeocoder,\n    private popoverCtrl: PopoverController,\n    public geolocation: Geolocation,\n    public timeFormat: TimeFormatProvider,\n    public events: Events) {\n\n    this.cityLocation = '(定位中)';\n    // this.events.subscribe('distance', () => {\n    //   if(this.isLoaded && this.isLocated){\n    //     for(let i= 0; i < this.disp$.length; i++){\n    //       if(!this.disp$[i]['calDistance']){\n    //         this.calDistance({lng: this.longitude, lat: this.latitude},this.disp$[i]['address'],i);\n    //       }\n    //     }\n    //   }\n    // });\n    \n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad ActivitylistPage');\n    this.loadData();\n    let options: NativeGeocoderOptions = {\n      useLocale: true,\n      maxResults: 5\n  };\n  this.geolocation.getCurrentPosition().then((resp)=>{\n    console.log(resp);\n    this.latitude = resp.coords.latitude;\n    this.longitude = resp.coords.longitude;\n    this.isLocated = true;\n    this.events.publish('distance');\n\n    this.geocoder.reverseGeocode(resp.coords.latitude, resp.coords.longitude, options)\n    .then((result: NativeGeocoderReverseResult[]) => {\n      console.log(JSON.stringify(result[0]));\n      this.cityLocation = result[0].locality;\n    })\n    .catch((error: any) => console.log(error));\n  }).catch(err=>{\n    console.log(err)\n  });\n\n  }\n\n  loadData(){\n    this.sub = this.fsp.getDailyEvent().snapshotChanges().pipe(\n      map(changes=>{\n        return changes.map(c=>({\n          key: c.payload.key, ...c.payload.val()\n        }))\n      })\n    ).subscribe(data=>{\n      console.log(data);\n      for(let i=0; i< data.length;i++){\n        let item = {};\n        item['key'] = data[i]['key'];\n        item['title'] = data[i]['title'];\n        item['address'] = data[i]['address'];\n        item['imgs'] = data[i]['imgs'];\n        item['firstBegin'] = data[i]['activityDate'][0]['from'];\n        item['activityDate'] = [];\n        for(let j=0; j<data[i]['activityDate'].length; j++){\n          let time = this.timeFormat.eventTimeFormat(data[i]['activityDate'][j]['from'], data[i]['activityDate'][j]['to']);\n          item['activityDate'].push(time);\n        }\n        if(data[i]['eventCategory1'])\n          item['isFree'] = '免费';\n        else\n          item['isFree'] = '收费';\n        if(data[i]['eventCategory2'])\n          item['isPublic'] = '公共活动';\n        else\n          item['isPublic'] = '私人活动';\n        item['numsLike'] = data[i]['numsLike'];\n        item['numsRead'] = data[i]['numsRead'];\n        item['distance'] = \"0 英里\";\n        item['calDistance'] = false;\n        this.disp$.push(item);\n      }\n      this.isLoaded = true;\n      this.events.publish('distance');\n      this.sub.unsubscribe();\n    });\n    // data.unsubscribe();\n  }\n\n  openDetail(key, numsRead){\n    console.log(key);\n    console.log(numsRead);\n    this.navCtrl.push('ActivityPage',{infoId:key});   \n  }\n\n  presentPopover(event) {\n    const popover = this.popoverCtrl.create(ActivityFilterComponent);\n    popover.present({\n      ev: event\n    });\n    popover.onDidDismiss(data=>{\n      switch(data.idx){\n        case 0:\n          this.disp$.sort(function(a,b){\n            return b.firstBegin - a.firstBegin;\n          });\n          return;\n        case 1:\n          this.disp$.sort(function(a,b){\n            return b.numsLike - a.numsLike\n          });\n      }\n    });\n  }\n\n  calDistance(o, d, index){\n    o = {lat: 34.1379, lng: -118.0537}\n    if(this.disp$[index]['calDistance']) return;\n    console.log(this.latitude);\n    console.log(this.longitude);\n    console.log(d);\n    var service = new google.maps.DistanceMatrixService();\n    let dataItem = this.disp$;\n    service.getDistanceMatrix(\n      {\n        origins: [o],\n        destinations: [{lat: 34.1379, lng: -118.0537}],\n        travelMode: 'DRIVING',\n        // drivingOptions: {\n        //   departureTime: new Date(Date.now()),  // for the time N milliseconds from now.\n        //   trafficModel: 'optimistic'\n        // }\n        unitSystem: google.maps.UnitSystem.IMPERIAL\n      }, callback);\n\n    \n    function callback(response, status) {\n      console.log(response);\n      if(response.rows[0]['elements'][0]['status'] == \"OK\"){\n        dataItem[index]['distance'] = response.rows[0]['elements'][0]['distance']['text'];\n        dataItem[index]['calDistance'] = true;\n        console.log(dataItem[index]);\n      }\n      // See Parsing the Results for\n      // the basics of a callback function.\n    }\n  }\n  \n\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/activitylist/activitylist.ts"],"sourceRoot":""}