{"version":3,"sources":["../../src/pages/activitylist/activitylist.module.ts","../../src/pages/activitylist/activitylist.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAwC;AACQ;AACE;AAalD;IAAA;IAAqC,CAAC;IAAzB,sBAAsB;QAXlC,uEAAQ,CAAC;YACR,YAAY,EAAE;gBACZ,uEAAgB;aACjB;YACD,OAAO,EAAE;gBACP,sEAAe,CAAC,QAAQ,CAAC,uEAAgB,CAAC;aAC3C;YACD,eAAe,EAAE;gBACf,uEAAgB;aACjB;SACF,CAAC;OACW,sBAAsB,CAAG;IAAD,6BAAC;CAAA;AAAH;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACfO;AAC0C;AACQ;AAEuB;AACxB;AACnC;AACqB;AACzC;AASpC;IAaE,0BACS,OAAsB,EACtB,SAAoB,EACpB,GAA4B,EAC3B,QAAwB,EACxB,WAA8B,EAC/B,WAAwB,EACxB,UAA8B,EAC9B,MAAc;QAPd,YAAO,GAAP,OAAO,CAAe;QACtB,cAAS,GAAT,SAAS,CAAW;QACpB,QAAG,GAAH,GAAG,CAAyB;QAC3B,aAAQ,GAAR,QAAQ,CAAgB;QACxB,gBAAW,GAAX,WAAW,CAAmB;QAC/B,gBAAW,GAAX,WAAW,CAAa;QACxB,eAAU,GAAV,UAAU,CAAoB;QAC9B,WAAM,GAAN,MAAM,CAAQ;QAnBvB,UAAK,GAAQ,EAAE,CAAC;QAIhB,cAAS,GAAY,KAAK,CAAC;QAC3B,aAAQ,GAAY,KAAK,CAAC;QAC1B,aAAQ,GAAW,EAAE,CAAC;QACtB,aAAQ,GAAW,aAAa,CAAC;QACjC,YAAO,GAAY,IAAI,CAAC;QACxB,gBAAW,GAAW,CAAC,CAAC;QAYtB,IAAI,CAAC,YAAY,GAAG,OAAO,CAAC;QAC5B,4CAA4C;QAC5C,yCAAyC;QACzC,iDAAiD;QACjD,2CAA2C;QAC3C,kGAAkG;QAClG,UAAU;QACV,QAAQ;QACR,MAAM;QACN,MAAM;IAER,CAAC;IAED,yCAAc,GAAd;QAAA,iBAwBC;QAvBC,OAAO,CAAC,GAAG,CAAC,iCAAiC,CAAC,CAAC;QAC/C,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QAClD,IAAI,OAAO,GAA0B;YACnC,SAAS,EAAE,IAAI;YACf,UAAU,EAAE,CAAC;SAChB,CAAC;QACF,IAAI,CAAC,WAAW,CAAC,kBAAkB,EAAE,CAAC,IAAI,CAAC,UAAC,IAAI;YAC9C,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAClB,KAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC;YACrC,KAAI,CAAC,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC;YACvC,KAAI,CAAC,SAAS,GAAG,IAAI,CAAC;YACtB,KAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;YAEhC,KAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,OAAO,CAAC;iBACjF,IAAI,CAAC,UAAC,MAAqC;gBAC1C,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACvC,KAAI,CAAC,YAAY,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC;YACzC,CAAC,CAAC;iBACD,KAAK,CAAC,UAAC,KAAU,IAAK,cAAO,CAAC,GAAG,CAAC,KAAK,CAAC,EAAlB,CAAkB,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC,KAAK,CAAC,aAAG;YACV,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC;QAClB,CAAC,CAAC,CAAC;IAEH,CAAC;IAED,mCAAQ,GAAR,UAAS,SAAS,EAAE,OAAO,EAAE,GAAG;QAAhC,iBAoDC;QAnDC,EAAE,EAAC,IAAI,CAAC,OAAO,CAAC;YAChB,oDAAQ,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,kBAAQ;gBAChJ,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,CAAC;gBAEpC,QAAQ,CAAC,OAAO,CAAC,cAAI;oBACnB,IAAI,IAAI,GAAG,EAAE,CAAC;oBACd,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC;oBACvB,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;oBACvB,EAAE,EAAC,KAAK,CAAC,YAAY,CAAC,GAAG,KAAI,CAAC,QAAQ,CAAC;wBACrC,KAAI,CAAC,QAAQ,GAAG,KAAK,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;oBAC1C,IAAI,CAAC,OAAO,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,CAAC;oBAC/B,IAAI,CAAC,SAAS,CAAC,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC;oBACnC,EAAE,EAAC,KAAK,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;wBAC9B,IAAI,CAAC,MAAM,CAAC,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC;oBAC/B,IAAI;wBACF,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;oBACpB,IAAI,CAAC,YAAY,CAAC,GAAG,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;oBACtD,IAAI,CAAC,cAAc,CAAC,GAAG,EAAE,CAAC;oBAC1B,GAAG,EAAC,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,KAAK,CAAC,cAAc,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAC,CAAC;wBAChD,IAAI,IAAI,GAAG,KAAI,CAAC,UAAU,CAAC,eAAe,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,EAAE,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;wBAC7G,IAAI,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBAClC,CAAC;oBACD,EAAE,EAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;wBACzB,IAAI,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC;oBACxB,IAAI;wBACF,IAAI,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC;oBACxB,EAAE,EAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;wBACzB,IAAI,CAAC,UAAU,CAAC,GAAG,MAAM,CAAC;oBAC5B,IAAI;wBACF,IAAI,CAAC,UAAU,CAAC,GAAG,MAAM,CAAC;oBAC5B,IAAI,CAAC,UAAU,CAAC,GAAG,KAAK,CAAC,UAAU,CAAC,CAAC;oBACrC,IAAI,CAAC,UAAU,CAAC,GAAG,KAAK,CAAC,UAAU,CAAC,CAAC;oBACrC,IAAI,CAAC,UAAU,CAAC,GAAG,MAAM,CAAC;oBAC1B,IAAI,CAAC,aAAa,CAAC,GAAG,KAAK,CAAC;oBAC5B,KAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBACtB,KAAI,CAAC,QAAQ,GAAG,MAAM,CAAC;gBACzB,CAAC,CAAC,CAAC;gBACH,KAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAS,CAAC,EAAC,CAAC;oBAC1B,MAAM,CAAC,CAAC,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,YAAY,CAAC,CAAC;gBAC3C,CAAC,CAAC,CAAC;gBAEH,EAAE,EAAC,QAAQ,CAAC,WAAW,EAAE,GAAG,GAAG,CAAC,EAAC;oBAC/B,KAAI,CAAC,OAAO,GAAG,KAAK,CAAC;oBACrB,KAAI,CAAC,QAAQ,GAAG,SAAS,CAAC;oBAC1B,OAAO,CAAC,GAAG,CAAC,KAAI,CAAC,QAAQ,CAAC,CAAC;gBAC7B,CAAC;gBAED,KAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;gBACrB,KAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;YAClC,CAAC,CAAC,CAAC;IAEL,CAAC;IAED,uCAAY,GAAZ;QACE,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,QAAQ,EAAC,IAAI,CAAC,WAAW,CAAC,CAAC;IACnD,CAAC;IAGD,qCAAU,GAAV,UAAW,GAAG,EAAE,QAAQ;QACtB,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACjB,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACtB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,EAAC,EAAC,MAAM,EAAC,GAAG,EAAC,CAAC,CAAC;IACjD,CAAC;IAED,yCAAc,GAAd,UAAe,KAAK;QAApB,iBAkBC;QAjBC,IAAM,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,4GAAuB,CAAC,CAAC;QACjE,OAAO,CAAC,OAAO,CAAC;YACd,EAAE,EAAE,KAAK;SACV,CAAC,CAAC;QACH,OAAO,CAAC,YAAY,CAAC,cAAI;YACvB,MAAM,EAAC,IAAI,CAAC,GAAG,CAAC,EAAC;gBACf,KAAK,CAAC;oBACJ,KAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAS,CAAC,EAAC,CAAC;wBAC1B,MAAM,CAAC,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC,UAAU,CAAC;oBACrC,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC;gBACT,KAAK,CAAC;oBACJ,KAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAS,CAAC,EAAC,CAAC;wBAC1B,MAAM,CAAC,CAAC,CAAC,QAAQ,GAAG,CAAC,CAAC,QAAQ;oBAChC,CAAC,CAAC,CAAC;YACP,CAAC;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED,sCAAW,GAAX,UAAY,CAAC,EAAE,CAAC,EAAE,KAAK;QACrB,CAAC,GAAG,EAAC,GAAG,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC,QAAQ,EAAC;QAClC,EAAE,EAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,aAAa,CAAC,CAAC;YAAC,MAAM,CAAC;QAC5C,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC3B,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAC5B,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QACf,IAAI,OAAO,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,qBAAqB,EAAE,CAAC;QACtD,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC;QAC1B,OAAO,CAAC,iBAAiB,CACvB;YACE,OAAO,EAAE,CAAC,CAAC,CAAC;YACZ,YAAY,EAAE,CAAC,EAAC,GAAG,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC,QAAQ,EAAC,CAAC;YAC9C,UAAU,EAAE,SAAS;YACrB,oBAAoB;YACpB,mFAAmF;YACnF,+BAA+B;YAC/B,IAAI;YACJ,UAAU,EAAE,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,QAAQ;SAC5C,EAAE,QAAQ,CAAC,CAAC;QAGf,kBAAkB,QAAQ,EAAE,MAAM;YAChC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YACtB,EAAE,EAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,EAAC;gBACpD,QAAQ,CAAC,KAAK,CAAC,CAAC,UAAU,CAAC,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,CAAC;gBAClF,QAAQ,CAAC,KAAK,CAAC,CAAC,aAAa,CAAC,GAAG,IAAI,CAAC;gBACtC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;YAC/B,CAAC;YACD,8BAA8B;YAC9B,qCAAqC;QACvC,CAAC;IACH,CAAC;IAlLU,gBAAgB;QAJ5B,wEAAS,CAAC;YACT,QAAQ,EAAE,mBAAmB;WACG;SACjC,CAAC;6EAe+B;YACX,6GAAS;YACf,sFAAuB;YACjB,wEAAc;YACX,+EAAiB;YAClB,8FAAW;YACZ,+DAAkB;YACtB,MAAM;OArBZ,gBAAgB,CAqL5B;IAAD,CAAC;AAAA;SArLY,gBAAgB,e","file":"10.js","sourcesContent":["import { NgModule} from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ActivitylistPage } from './activitylist';\n\n@NgModule({\n  declarations: [\n    ActivitylistPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ActivitylistPage),\n  ],\n  entryComponents: [\n    ActivitylistPage,\n  ]\n})\nexport class ActivitylistPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/activitylist/activitylist.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, PopoverController, Events} from 'ionic-angular';\nimport { FirebaseServiceProvider } from '../../providers/firebase-service/firebase-service';\nimport { map } from 'rxjs/operators';\nimport { NativeGeocoder, NativeGeocoderOptions, NativeGeocoderReverseResult } from '@ionic-native/native-geocoder';\nimport { ActivityFilterComponent } from '../../components/activity-filter/activity-filter';\nimport { Geolocation } from '@ionic-native/geolocation';\nimport { TimeFormatProvider } from '../../providers/time-format/time-format';\nimport firebase from 'firebase/app';\n\ndeclare var google;\n@IonicPage()\n\n@Component({\n  selector: 'page-activitylist',\n  templateUrl: 'activitylist.html',\n})\nexport class ActivitylistPage {\n\n  disp$: any = [];\n  cityLocation: string;\n  longitude: number;\n  latitude: number;\n  isLocated: boolean = false;\n  isLoaded: boolean = false;\n  readMore: string = \"\";\n  lastTime: number = 4698626463000;\n  hasMore: boolean = true;\n  numsForEach: number = 5;\n\n  constructor(\n    public navCtrl: NavController, \n    public navParams: NavParams, \n    public fsp: FirebaseServiceProvider,\n    private geocoder: NativeGeocoder,\n    private popoverCtrl: PopoverController,\n    public geolocation: Geolocation,\n    public timeFormat: TimeFormatProvider,\n    public events: Events) {\n\n    this.cityLocation = '(定位中)';\n    // this.events.subscribe('distance', () => {\n    //   if(this.isLoaded && this.isLocated){\n    //     for(let i= 0; i < this.disp$.length; i++){\n    //       if(!this.disp$[i]['calDistance']){\n    //         this.calDistance({lng: this.longitude, lat: this.latitude},this.disp$[i]['address'],i);\n    //       }\n    //     }\n    //   }\n    // });\n    \n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad ActivitylistPage');\n    this.loadData(0, this.lastTime, this.numsForEach);\n    let options: NativeGeocoderOptions = {\n      useLocale: true,\n      maxResults: 5\n  };\n  this.geolocation.getCurrentPosition().then((resp)=>{\n    console.log(resp);\n    this.latitude = resp.coords.latitude;\n    this.longitude = resp.coords.longitude;\n    this.isLocated = true;\n    this.events.publish('distance');\n\n    this.geocoder.reverseGeocode(resp.coords.latitude, resp.coords.longitude, options)\n    .then((result: NativeGeocoderReverseResult[]) => {\n      console.log(JSON.stringify(result[0]));\n      this.cityLocation = result[0].locality;\n    })\n    .catch((error: any) => console.log(error));\n  }).catch(err=>{\n    console.log(err)\n  });\n\n  }\n\n  loadData(startTime, endTime, num){\n    if(this.hasMore)\n    firebase.database().ref('/DailyEvents/').orderByChild('createDate').startAt(startTime).endAt(endTime).limitToLast(num).once('value').then(snapshot => {\n      console.log(snapshot.numChildren());\n      \n      snapshot.forEach(data =>{\n        let item = {};\n        item['key'] = data.key;\n        let value = data.val();\n        if(value['createDate'] < this.lastTime)\n          this.lastTime = value['createDate'] - 1;\n        item['title'] = value['title'];\n        item['address'] = value['address'];\n        if(value.hasOwnProperty('imgs'))\n          item['imgs'] = value['imgs'];\n        else \n          item['imgs'] = [];\n        item['firstBegin'] = value['activityDate'][0]['from'];\n        item['activityDate'] = [];\n        for(let j=0; j<value['activityDate'].length; j++){\n          let time = this.timeFormat.eventTimeFormat(value['activityDate'][j]['from'], value['activityDate'][j]['to']);\n          item['activityDate'].push(time);\n        }\n        if(value['eventCategory1'])\n          item['isFree'] = '免费';\n        else\n          item['isFree'] = '收费';\n        if(value['eventCategory2'])\n          item['isPublic'] = '公共活动';\n        else\n          item['isPublic'] = '私人活动';\n        item['numsLike'] = value['numsLike'];\n        item['numsRead'] = value['numsRead'];\n        item['distance'] = \"0 英里\";\n        item['calDistance'] = false;\n        this.disp$.push(item);\n        this.readMore = \"查看更多\";\n      });\n      this.disp$.sort(function(a,b){\n        return b['firstBegin'] - a['firstBegin'];\n      });\n\n      if(snapshot.numChildren() < num){\n        this.hasMore = false;\n        this.readMore = \"没有更多活动了\";\n        console.log(this.readMore);\n      }\n\n      this.isLoaded = true;\n      this.events.publish('distance');\n    });\n      \n  }\n\n  loadMoreData(){\n    this.loadData(0, this.lastTime,this.numsForEach);\n  }\n\n\n  openDetail(key, numsRead){\n    console.log(key);\n    console.log(numsRead);\n    this.navCtrl.push('ActivityPage',{infoId:key});   \n  }\n\n  presentPopover(event) {\n    const popover = this.popoverCtrl.create(ActivityFilterComponent);\n    popover.present({\n      ev: event\n    });\n    popover.onDidDismiss(data=>{\n      switch(data.idx){\n        case 0:\n          this.disp$.sort(function(a,b){\n            return b.firstBegin - a.firstBegin;\n          });\n          return;\n        case 1:\n          this.disp$.sort(function(a,b){\n            return b.numsLike - a.numsLike\n          });\n      }\n    });\n  }\n\n  calDistance(o, d, index){\n    o = {lat: 34.1379, lng: -118.0537}\n    if(this.disp$[index]['calDistance']) return;\n    console.log(this.latitude);\n    console.log(this.longitude);\n    console.log(d);\n    var service = new google.maps.DistanceMatrixService();\n    let dataItem = this.disp$;\n    service.getDistanceMatrix(\n      {\n        origins: [o],\n        destinations: [{lat: 34.1379, lng: -118.0537}],\n        travelMode: 'DRIVING',\n        // drivingOptions: {\n        //   departureTime: new Date(Date.now()),  // for the time N milliseconds from now.\n        //   trafficModel: 'optimistic'\n        // }\n        unitSystem: google.maps.UnitSystem.IMPERIAL\n      }, callback);\n\n    \n    function callback(response, status) {\n      console.log(response);\n      if(response.rows[0]['elements'][0]['status'] == \"OK\"){\n        dataItem[index]['distance'] = response.rows[0]['elements'][0]['distance']['text'];\n        dataItem[index]['calDistance'] = true;\n        console.log(dataItem[index]);\n      }\n      // See Parsing the Results for\n      // the basics of a callback function.\n    }\n  }\n  \n\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/activitylist/activitylist.ts"],"sourceRoot":""}